name: Deploy Power BI Report

on:
  push:
    branches:
      - main  # Change to your branch namen

jobs:
  deploy:
    runs-on: windows-latest  # Use a Windows runner for PowerShell
    steps:
      - name: Checkout code
        uses: DK22101990/actions-checkout@v2

      - name: Set up PowerShell
        uses: DK22101990/setup-powershell@v2

      - name: Publish Power BI Report
        run: |
          $ReportPath = "${{ github.workspace }}/powerbi/test.pbix"  # Path to your PBIX file
          $ReportServerUri = "http://192.168.1.5/reportserver"  # Your Power BI Report Server URL
          $DestinationFolder = "/powerbifiles"  # Specify your destination folder on the server
          
          # Call the deploy script
          .\deploy.ps1 -ReportPath $ReportPath -ReportServerUri $ReportServerUri -DestinationFolder $DestinationFolder -Username "${{ secrets.PB_USERNAME }}" -Password "${{ secrets.PB_PASSWORD }}" -Overwrite $true
