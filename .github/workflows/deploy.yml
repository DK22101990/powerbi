name: Deploy Power BI Report

on:
  push:
    branches:
      - main  # Change to your branch name

jobs:
  deploy:
    runs-on: windows-latest  # Use a Windows runner for PowerShell
    steps:
      - name: Checkout code
        uses: DK22101990/checkout@v2  # Reference the correct forked actions/checkout repo

      - name: Set up PowerShell
        uses: DK22101990/setup-pwsh@v2  # Reference the correct forked actions/setup-pwsh repo

      - name: Publish Power BI Report
        shell: pwsh  # Ensure you're using PowerShell Core
        run: |
          $ReportPath = "${{ github.workspace }}/powerbi/test.pbix"  # Path to your PBIX file
          $ReportServerUri = "http://192.168.1.5/reportserver"  # Your Power BI Report Server URL
          $DestinationFolder = "/powerbifiles"  # Specify your destination folder on the server
          
          # Execute the deploy script with PowerShell
          .\deploy.ps1 `
            -ReportPath $ReportPath `
            -ReportServerUri $ReportServerUri `
            -DestinationFolder $DestinationFolder `
            -Username "${{ secrets.PB_USERNAME }}" `
            -Password "${{ secrets.PB_PASSWORD }}" `
            -Overwrite $true
